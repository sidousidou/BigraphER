language: none

env:
  - OCAML_VERSION=4.02.0
  - OCAML_VERSION=4.02.1
  - OCAML_VERSION=4.02.2
  - OCAML_VERSION=4.02.3
  - OCAML_VERSION=4.03.0
  - OCAML_VERSION=4.03.0_flambda

build:
  pre_ci_boot:
      image_name: mseve/bigrapher
      image_tag: shippable_ubuntu_$OCAML_VERSION
      pull: true
#      options: "-e HOME=/root"

  ci:
    - sudo apt-get -qy update
    - sudo apt-get -qy upgrade
    - opam update -y -u
    - mkdir -p shippable/linktest
    - mkdir -p shippable/svg
    - mkdir -p shippable/svg/rpoTest0
    - mkdir -p shippable/svg/rpoTest1
    - mkdir -p shippable/svg/rpoTest2
    - mkdir -p shippable/svg/rpoTest3
    - mkdir -p shippable/svg/rpoTest4
    - mkdir -p shippable/svg/rpoTest5
    - mkdir -p shippable/parser
    - mkdir -p shippable/bisect/html
    - mkdir -p shippable/api
    - mkdir -p shippable/man
    - ./scripts/shippable-build.sh
    - ./scripts/shippable-doc.sh
    - ./scripts/shippable-link.sh
    - ./scripts/shippable-opam-lint.sh
    - ./scripts/shippable-cover.sh

integrations:
  notifications:
    - integrationName: email
      type: email
      recipients:
        - Michele.Sevegnani@glasgow.ac.uk
      on_success: change
      on_failure: always
    - integrationName: bigrapher-slack
      type: slack
      recipients:
        - "#dev"
      on_success: never
      on_failure: always
