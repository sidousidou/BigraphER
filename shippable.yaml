language: none

env:
  - OCAML_VERSION=4.06
  - OCAML_VERSION=4.07
  - OCAML_VERSION=4.08
  - OCAML_VERSION=4.09
  - OCAML_VERSION=4.10

build:
  pre_ci_boot:
      image_name: ocaml/opam2
      image_tag: $OCAML_VERSION
      pull: true

  ci:
    - sudo apt-get -qy update && sudo apt-get -qy upgrade && sudo apt-get -qy install pkg-config m4 zlib1g-dev minisat graphviz
    - sh -c "cd ~/opam-repository && git pull -q"
    - opam install -y dune
    - eval $(opam env)
    - mkdir -p shippable/testresults
    - mkdir -p shippable/svg
    - mkdir -p shippable/parser
    - mkdir -p shippable/man
    - dune runtest --profile=release
    - cp _build/default/test/shippable/testresults/*.xml shippable/testresults/
