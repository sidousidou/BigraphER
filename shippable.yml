language: none

env:
  - OCAML_VERSION=4.03
  - OCAML_VERSION=4.04
  - OCAML_VERSION=4.05
  - OCAML_VERSION=4.06
  - OCAML_VERSION=4.07
  - OCAML_VERSION=4.08
  - OCAML_VERSION=4.09


build:
  pre_ci_boot:
      image_name: ocaml/opam2
      image_tag: $OCAML_VERSION
      pull: true

  ci:
    - sudo apt-get -qy update && sudo apt-get -qy upgrade && sudo apt-get -qy install pkg-config m4 zlib1g-dev minisat graphviz
    - opam repository add glasgow "http://www.dcs.gla.ac.uk/~michele/dcs-opam-repository/" && opam update -y -u && opam install -y big_json conf-graphviz menhir && eval $(opam env)
    - mkdir -p shippable/testresults
    - mkdir -p shippable/svg
    - mkdir -p shippable/parser
    - mkdir -p shippable/man
    - dune runtest
    
integrations:
  notifications:
    - integrationName: email
      type: email
      recipients:
        - Michele.Sevegnani@glasgow.ac.uk
      on_success: change
      on_failure: always
    - integrationName: bigrapher-slack
      type: slack
      recipients:
        - "#dev"
      on_success: never
      on_failure: always